# سیستم مدیریت حساب‌های اعتباری

## overview
این سیستم یک راه‌حل جامع برای مدیریت حساب‌های اعتباری در پارکینگ هوشمند است که امکانات کاملی برای مدیریت مشتریان، حساب‌ها، خودروها و تراکنش‌ها را فراهم می‌کند.

## ویژگی‌های اصلی

### 1. مدیریت مشتریان
- **ایجاد مشتری جدید**: با اطلاعات کامل (نام، ایمیل، تلفن، کد ملی، آدرس)
- **جستجوی مشتریان**: بر اساس نام، ایمیل یا شماره تلفن
- **مشاهده اطلاعات مشتری**: شامل تاریخ ثبت نام و تعداد حساب‌ها
- **مدیریت وضعیت مشتری**: فعال/غیرفعال کردن حساب‌ها

### 2. مدیریت حساب‌های اعتباری
- **ایجاد حساب جدید**: با تنظیمات پیشرفته (موجودی اولیه، محدودیت‌ها، آستانه‌ها)
- **شارژ حساب**: امکان شارژ دستی با توضیحات
- **مشاهده وضعیت حساب**: موجود فعلی، محدودیت ماهانه، سقف اعتبار
- **تنظیمات هشدار**: آستانه‌های مختلف برای هشدار کمبود موجودی
- **شارژ خودکار**: تنظیم شارژ ماهانه خودکار

### 3. مدیریت خودروها
- **ثبت خودرو**: با پلاک، نوع خودرو، اطلاعات مالک
- **چند خودرویی**: امکان ثبت چندین خودرو برای هر مشتری
- **انواع خودرو**: پشتیبانی از خودرو، موتورسیکلت، کامیون، اتوبوس، وانت
- **مدیریت دسترسی**: مجاز/غیرمجاز کردن خودروها

### 4. مدیریت تراکنش‌ها
- **ثبت تراکنش**: انواع شارژ، کسر، بازگشت، تنظیم
- **تاریخچه تراکنش‌ها**: مشاهده تمام تراکنش‌های هر حساب
- **فیلتر تراکنش‌ها**: بر اساس نوع، تاریخ، حساب
- **گزارش تراکنش‌ها**: خلاصه آماری تراکنش‌ها

### 5. سیستم گزارش‌گیری
- **گزارش خلاصه حساب‌ها**: آمار کلی حساب‌ها و موجودی‌ها
- **گزارش تراکنش‌ها**: تحلیل تراکنش‌ها در بازه زمانی
- **گزارش استفاده**: آمار استفاده از پارکینگ توسط مشتریان
- **گزارش‌های سفارشی**: با فیلترهای دلخواه

### 6. سیستم جستجو
- **جستجوی پیشرفته**: بر اساس نام، ایمیل، پلاک خودرو
- **فیلترهای ترکیبی**: ترکیب چندین شرط جستجو
- **جستجوی لحظه‌ای**: نتایج به صورت زنده نمایش داده می‌شوند

## ساختار API

### 1. مشتریان
- `GET /api/customers` - دریافت لیست مشتریان
- `POST /api/customers` - ایجاد مشتری جدید

### 2. حساب‌های اعتباری
- `GET /api/credit-accounts` - دریافت لیست حساب‌ها
- `POST /api/credit-accounts` - ایجاد حساب جدید
- `POST /api/credit-accounts/charge` - شارژ حساب
- `GET /api/credit-accounts/transactions` - دریافت تراکنش‌ها

### 3. خودروها
- `GET /api/vehicles` - دریافت لیست خودروها
- `POST /api/vehicles` - ثبت خودرو جدید

### 4. گزارش‌ها
- `POST /api/reports` -生成 گزارش

## ساختار پایگاه داده

### جداول اصلی
1. **users**: اطلاعات کاربران/مشتریان
2. **credit_accounts**: حساب‌های اعتباری
3. **credit_account_settings**: تنظیمات حساب‌ها
4. **credit_transactions**: تراکنش‌های مالی
5. **credit_notifications**: اعلان‌های سیستم
6. **vehicles**: اطلاعات خودروها
7. **parking_sessions**: جلسات پارکینگ

### روابط بین جداول
- هر کاربر می‌تواند چندین حساب اعتباری داشته باشد
- هر حساب اعتباری متعلق به یک کاربر است
- هر حساب می‌تواند چندین تراکنش داشته باشد
- هر خودرو می‌تواند چندین جلسه پارکینگ داشته باشد

## رابط کاربری

### صفحه اصلی
- **لیست حساب‌ها**: نمایش کارت‌های حساب‌ها با اطلاعات اصلی
- **دکمه‌های عملیاتی**: شارژ، مشاهده جزئیات، دانلود گزارش
- **جستجو**: نوار جستجوی سریع
- **دکمه ایجاد**: ایجاد حساب جدید

### دیالوگ ایجاد حساب
- **اطلاعات مشتری**: نام، ایمیل، تلفن، کد ملی، آدرس
- **اطلاعات حساب**: موجودی اولیه، محدودیت‌ها، آستانه‌ها
- **خودروها**: افزودن چندین خودرو با پلاک و نوع
- **تنظیمات اعلان**: ایمیل، SMS، اعلان درون برنامه‌ای

### دیالوگ شارژ حساب
- **انتخاب حساب**: نمایش اطلاعات حساب انتخاب شده
- **مبلغ شارژ**: ورود مبلغ شارژ
- **توضیحات**: توضیحات اختیاری برای شارژ
- **تأیید**: انجام عملیات شارژ

## امنیت

### احراز هویت
- استفاده از JWT برای احراز هویت
- نقش‌های کاربری مختلف (OPERATOR, SUPERVISOR, ADMIN, AUDITOR)
- کنترل دسترسی بر اساس نقش‌ها

### محافظت از داده‌ها
- رمزنگاری رمز عبور با bcrypt
- اعتبارسنجی ورودی‌ها
- محافظت در برابر SQL Injection
- استفاده از Transactions برای یکپارچگی داده‌ها

## عملکرد

### بهینه‌سازی
- استفاده از Prisma ORM برای مدیریت پایگاه داده
- Pagination برای لیست‌های طولانی
- Lazy loading برای داده‌های مرتبط
- کش کردن داده‌های پرکاربرد

### مقیاس‌پذیری
- ساختار ماژولار
- جدا کردن منطق کسب و کار از رابط کاربری
- استفاده از API استاندارد REST
- پشتیبانی از افزایش تعداد کاربران

## نصب و راه‌اندازی

### پیش‌نیازها
- Node.js 18+
- SQLite 3
- Prisma CLI

### مراحل نصب
1. نصب وابستگی‌ها: `npm install`
2. تنظیم پایگاه داده: `npx prisma generate`
3. اجرای مهاجرت‌ها: `npx prisma db push`
4. اجرای توسعه: `npm run dev`

## استفاده

### ایجاد حساب جدید
1. کلیک روی دکمه "ایجاد حساب جدید"
2. پر کردن اطلاعات مشتری
3. تنظیم پارامترهای حساب
4. افزودن خودروها
5. کلیک روی "ایجاد حساب"

### شارژ حساب
1. کلیک روی دکمه "شارژ" در کارت حساب
2. وارد کردن مبلغ شارژ
3. افزودن توضیحات (اختیاری)
4. کلیک روی "شارژ حساب"

### مشاهده گزارش‌ها
1. انتخاب نوع گزارش
2. تنظیم بازه زمانی
3. انتخاب حساب (اختیاری)
4. کلیک روی "生成 گزارش"

## عیب‌یابی

### مشکلات رایج
1. **خطای اتصال به پایگاه داده**: بررسی اتصال SQLite
2. **کندی بارگذاری**: بهینه‌سازی کوئری‌ها و استفاده از کش
3. **خطای احراز هویت**: بررسی توکن و نقش کاربری
4. **مشکل در شارژ حساب**: بررسی موجودی و محدودیت‌ها

### لاگ‌ها
- لاگ‌های سرور در `dev.log`
- لاگ‌های پایگاه داده در کنسول
- لاگ‌های خطا در فایل‌های مربوطه

## توسعه آینده

### قابلیت‌های برنامه‌ریزی شده
1. **سیستم پرداخت آنلاین**: اتصال به درگاه‌های پرداخت
2. **اپلیکیشن موبایل**: اپلیکیشن برای مشتریان
3. **گزارش‌های پیشرفته**: تحلیل‌های پیشرفته‌تر
4. **یکپارچه‌سازی**: اتصال به سیستم‌های دیگر
5. **هوش مصنوعی**: پیش‌بینی استفاده و بهینه‌سازی

### بهبودهای فنی
1. **کش پیشرفته**: استفاده از Redis
2. **پایگاه داده**: مهاجرت به PostgreSQL
3. **میکروسرویس‌ها**: تقسیم سیستم به سرویس‌های کوچکتر
4. **مانیتورینگ**: سیستم مانیتورینگ پیشرفته
5. **تست‌ها**: افزودن تست‌های واحد و یکپارچه‌سازی